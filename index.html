<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Dívidas - Dashboard</title>
<meta name="theme-color" content="#343541">
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#343541; color:#ececec; overflow-x:hidden; min-height:100vh; font-size:16px; }
* { scrollbar-width: thin; scrollbar-color: #565869 transparent; }
*::-webkit-scrollbar{width:8px;}
*::-webkit-scrollbar-thumb{background:#565869;border-radius:10px;}
*::-webkit-scrollbar-thumb:hover{background:#6b6e7c;}
.menu-toggle { display:flex; position:fixed; top:12px; left:12px; z-index:1003; width:70px; height:70px; border-radius:50%; border:none; background:#444654; color:#ececec; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.3); transition:0.2s; font-size:2em; animation: pulse-white 2.5s ease-in-out infinite; }
.menu-toggle:hover{background:#565869;}
@keyframes pulse-white{0%{box-shadow:0 0 10px rgba(255,255,255,0.3);}50%{box-shadow:0 0 20px rgba(255,255,255,0.6);}100%{box-shadow:0 0 10px rgba(255,255,255,0.3);}}
.sidebar { position:fixed; top:70px; left:0; width:80vw; max-width:280px; height:calc(100% - 70px); background:rgba(32,33,35,0.95); color:white; flex-direction:column; border-right:1px solid rgba(255,255,255,0.1); overflow-y:auto; transform:translateX(-100%); z-index:1001; transition:transform 0.25s ease-in-out; }
@media(max-width:360px){ .sidebar {width:90vw;} }
.sidebar.show{transform:translateX(0);}
.sidebar h2{font-size:1.4em;font-weight:bold;padding:18px;margin:0;border-bottom:1px solid rgba(255,255,255,0.1);cursor:pointer;}
.devedores-list li{margin:10px;padding:16px 20px;border-radius:12px;cursor:pointer;transition:background 0.2s;font-size:1.1em;}
.devedores-list li:hover{background:rgba(255,255,255,0.1);}
.devedores-list li.active{background:rgba(255,255,255,0.2);font-weight:600;}
.sidebar-footer{ padding:10px 0; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:center; }
.footer-card { display:flex; flex-direction: column; gap: 8px; width: 90%; align-items:center; margin-top:auto; }
.chatgpt-btn { display:flex; align-items:center; gap:10px; padding:8px; border-radius:16px; background:#444654; color:#ececec; border:none; font-size:0.9em; cursor:pointer; width:100%; justify-content:center; transition: transform 0.2s, background 0.2s; }
.chatgpt-btn:hover{background:#565869;transform:scale(1.03);}
.sidebar-overlay { position:fixed; top:70px; left:0; width:100%; height:calc(100% - 70px); background:rgba(0,0,0,0.4); z-index:1000; opacity:0; display:none; transition:opacity 0.25s ease-in-out; }
.sidebar-overlay.show{display:block;opacity:1;}
.main { padding:80px 12px 20px 12px; display:flex; justify-content:center; align-items:center; flex-direction:column; min-height:calc(100vh - 70px); overflow:hidden; }
.dashboard{ display:flex; flex-direction:column; align-items:center; gap:16px; width:100%; max-width:400px; }
.header-devedor{ font-size:1.8em; font-weight:bold; margin-bottom:18px; color:#fff; background:#444654; padding:12px; border-radius:12px; text-align:center; width:100%; box-sizing:border-box; }
.mini-card,.divida-item{ width:100%; background:#444654; border-radius:16px; padding:12px; box-shadow:0 4px 12px rgba(0,0,0,0.25); opacity:0; transform:translateY(30px); transition:transform 0.5s ease, opacity 0.5s ease; font-size:1em; }
.mini-card.show,.divida-item.show{opacity:1; transform:translateY(0);}
.divida-top{display:flex;justify-content:space-between;align-items:center;}
.status{padding:6px 12px;border-radius:12px;font-weight:600;font-size:0.95em;}
.valor-parcela{background:#19c37d;color:white;padding:4px 8px;border-radius:8px;font-weight:bold;font-size:0.95em;}
.divida-actions{display:flex;gap:12px;margin-top:14px;}
.divida-actions button{ flex:1; padding:10px; border:none; border-radius:20px; background:#565869; color:#ececec; font-weight:600; cursor:pointer; transition:0.2s; font-size:0.95em;}
.divida-actions button:hover{background:#6b6e7c;transform:scale(1.05);}
.sub-card { background: #4a4c5a; border-radius: 16px; padding: 12px; margin-top: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.25); display: flex; flex-direction: column; gap: 8px; font-size: 0.95em; }
.sub-card input { width: 100%; padding: 8px; border-radius: 12px; border: 1px solid #565869; background: #343541; color: #ececec; font-size: 0.95em; box-sizing: border-box; }
.sub-card button { flex: 1; padding: 10px; border-radius: 20px; border: none; background: #565869; color: #ececec; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95em; }
.sub-card button:hover { background:#6b6e7c; transform: scale(1.05); }
.modal{display:flex;align-items:center;justify-content:center;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1002;opacity:0;pointer-events:none;transition:0.3s;}
.modal.show{opacity:1;pointer-events:auto;}
.modal-content{ background:#343541; color:#ececec; border-radius:12px; padding:12px; width:95%; max-width:400px; max-height:90vh; display:flex; flex-direction:column; gap:12px; overflow-y:auto; font-size:1em; }
.modal-content input,.modal-content select{width:100%;padding:10px;border-radius:8px;background:#4a4c5a;border:1px solid #565869;color:#ececec;margin-bottom:10px;box-sizing:border-box;font-size:0.95em;}
.wizard-tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
.wizard-tabs .tab{flex:1;text-align:center;padding:12px;border-radius:8px;background:#444654;cursor:pointer;font-size:1em;}
.wizard-tabs .tab.active{background:#565869;font-weight:bold;}
.step{display:none;flex-direction:column;}
.step.active{display:flex;}
.step-buttons{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;}
.step-buttons button{flex:1;padding:16px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1em;}
.btn-save{background:#19c37d;color:white;}
.btn-cancel{background:#ef4146;color:white;}
.close{cursor:pointer;font-size:1.7em;align-self:flex-end;}
</style>
</head>
<body>

<button class="menu-toggle" id="menu-toggle">☰</button>
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<aside class="sidebar">
  <h2 id="header-devedores">Devedores</h2>
  <ul class="devedores-list"></ul>
  <div class="sidebar-footer">
    <div class="footer-card">
      <button class="chatgpt-btn" id="add-btn">Adicionar Dívida</button>
      <button class="chatgpt-btn" id="export-btn">Exportar</button>
      <button class="chatgpt-btn" id="import-btn">Importar</button>
      <input type="file" id="import-file" style="display:none" accept=".json">
    </div>
  </div>
</aside>

<main class="main">
  <div class="dashboard" id="dashboard"></div>
</main>

<!-- Modal Wizard -->
<div class="modal" id="modal-divida">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div class="wizard-tabs">
      <div class="tab active" data-step="1">Item</div>
      <div class="tab" data-step="2">Banco</div>
      <div class="tab" data-step="3">Devedor</div>
      <div class="tab" data-step="4">Parcelamento</div>
      <div class="tab" data-step="5">Vencimento</div>
    </div>
    <div class="step step-1 active">
      <label>Item:</label>
      <input type="text" class="field" data-key="item" placeholder="Ex.: Conta de luz">
      <label>Valor:</label>
      <input type="number" class="field" data-key="valor" step="0.01" min="0.01">
    </div>
    <div class="step step-2">
      <label>Banco:</label>
      <input type="text" class="field" data-key="banco" placeholder="Ex.: Nubank">
    </div>
    <div class="step step-3">
      <label>Devedor:</label>
      <input type="text" class="field" data-key="devedor" placeholder="Ex.: João">
      <label>Salário:</label>
      <input type="number" id="input-salario" step="0.01" min="0" value="0">
    </div>
    <div class="step step-4">
      <label>Parcela Atual:</label>
      <input type="number" class="field" data-key="parcelaAtual" value="1" min="1">
      <label>Total de Parcelas:</label>
      <input type="number" class="field" data-key="totalParcelas" value="1" min="1">
    </div>
    <div class="step step-5">
      <label>Vencimento:</label>
      <input type="date" class="field" data-key="vencimentoFatura">
    </div>
    <div class="step-buttons">
      <button class="prev-btn">← Anterior</button>
      <button class="next-btn">Próximo →</button>
      <button class="btn-save">Salvar</button>
      <button class="btn-cancel">Cancelar</button>
    </div>
  </div>
</div>

<script>
var App = {
  dividas: JSON.parse(localStorage.getItem("dividasDaCasa")||"[]"),
  saldosDevedores: JSON.parse(localStorage.getItem("saldosDevedores")||"{}"),
  abatimentosDevedores: JSON.parse(localStorage.getItem("abatimentosDevedores")||"{}"),
  devedorSelecionado: null,
  sidebarList: document.querySelector(".devedores-list"),
  dashboard: document.getElementById("dashboard"),
  modal: document.getElementById("modal-divida"),
  fields: [],
  editIndex: null,
  currentStep:1,

  init: function(){
    var f = document.querySelectorAll(".field");
    for(var i=0;i<f.length;i++){this.fields.push(f[i]);}
    this.renderSidebar();
    this.bindUI();
    this.renderDashboard();
  },

  bindUI: function(){
    var self=this;
    document.getElementById("add-btn").onclick=function(){self.showModal();};
    this.modal.querySelector(".close").onclick=function(){self.hideModal();};
    this.modal.querySelector(".btn-cancel").onclick=function(){self.hideModal();};
    this.modal.querySelector(".btn-save").onclick=function(){self.saveDivida();};
    document.getElementById("export-btn").onclick=function(){self.exportData();};
    document.getElementById("import-btn").onclick=function(){document.getElementById("import-file").click();};
    document.getElementById("import-file").onchange=function(e){self.importData(e);};
    this.modal.querySelector('.next-btn').onclick=function(){if(self.currentStep<5)self.showStep(self.currentStep+1);};
    this.modal.querySelector('.prev-btn').onclick=function(){if(self.currentStep>1)self.showStep(self.currentStep-1);};
    var tabs=document.querySelectorAll('.wizard-tabs .tab');
    for(var i=0;i<tabs.length;i++){tabs[i].onclick=function(){self.showStep(parseInt(this.getAttribute("data-step")));};}

    document.getElementById('header-devedores').onclick=function(){self.devedorSelecionado=null;self.renderSidebar();self.renderDashboard();closeSidebar();};

    var menuToggle=document.getElementById("menu-toggle");
    var sidebar=document.querySelector(".sidebar");
    var overlay=document.getElementById("sidebar-overlay");
    menuToggle.onclick=function(){sidebar.classList.toggle("show");overlay.classList.toggle("show");};
    overlay.onclick=function(){closeSidebar();};

    this.dashboard.addEventListener("click", function(e){
      var btn=e.target;
      var dividaItem=btn.closest(".divida-item");
      if(dividaItem){
        var idx=Array.prototype.indexOf.call(self.dashboard.querySelectorAll(".divida-item"),dividaItem);
        if(btn.classList.contains("btn-pago")){ self.dividas[idx].paga=!self.dividas[idx].paga; self.save(); }
        if(btn.classList.contains("btn-editar")){ self.editDivida(idx); }
        if(btn.classList.contains("btn-excluir")){ if(confirm("Excluir?")){ self.dividas.splice(idx,1); self.save(); } }
      }
      if(btn.id=="btn-abater"){
        var v=parseFloat(document.getElementById("input-abater").value)||0;
        var atual=self.abatimentosDevedores[self.devedorSelecionado]||0;
        var total=0;
        var lista=self.dividas;
        for(var i=0;i<lista.length;i++){if(lista[i].devedor===self.devedorSelecionado) total+=lista[i].valor/lista[i].totalParcelas;}
        atual+=v; if(atual>total) atual=total;
        self.abatimentosDevedores[self.devedorSelecionado]=atual;
        self.saveAbatimentos();
        self.renderDashboard();
      }
      if(btn.id=="btn-resetar"){
        self.abatimentosDevedores[self.devedorSelecionado]=0;
        self.saveAbatimentos();
        self.renderDashboard();
      }
    });

    // Swipe para mobile
    var startX=0,endX=0;
    document.body.addEventListener("touchstart",function(e){startX=e.changedTouches[0].screenX;});
    document.body.addEventListener("touchend",function(e){
      endX=e.changedTouches[0].screenX;
      var diff=endX-startX;
      if(diff>50){ sidebar.classList.add("show"); overlay.classList.add("show"); }
      else if(diff<-50){ sidebar.classList.remove("show"); overlay.classList.remove("show"); }
    });
  },

  showStep: function(n){this.currentStep=n;var s=document.querySelectorAll('.step');for(var i=0;i<s.length;i++){s[i].classList.remove('active');}document.querySelector('.step-'+n).classList.add('active');var t=document.querySelectorAll('.wizard-tabs .tab');for(var i=0;i<t.length;i++){t[i].classList.remove('active');}document.querySelector('.wizard-tabs .tab[data-step="'+n+'"]').classList.add('active');},

  capitalizeName:function(name){var w=name.split(' '),r=[];for(var i=0;i<w.length;i++){r.push(w[i].charAt(0).toUpperCase()+w[i].slice(1).toLowerCase());}return r.join(' ');},

  renderSidebar: function(){
    var devedores=[],lista=this.dividas;
    for(var i=0;i<lista.length;i++){if(devedores.indexOf(lista[i].devedor)===-1) devedores.push(lista[i].devedor);}
    this.sidebarList.innerHTML="";
    for(var i=0;i<devedores.length;i++){
      var li=document.createElement('li');
      li.setAttribute('data-dev',devedores[i]);
      if(this.devedorSelecionado===devedores[i]) li.className="active";
      li.innerHTML=this.capitalizeName(devedores[i]);
      var self2=this;
      li.onclick=function(){self2.devedorSelecionado=this.getAttribute('data-dev');self2.renderSidebar();self2.renderDashboard();closeSidebar();};
      this.sidebarList.appendChild(li);
    }
  },

  renderDashboard:function(){
    this.dashboard.innerHTML='';
    if(!this.devedorSelecionado){var txtEl=document.createElement('div');txtEl.style.textAlign="center";txtEl.style.marginTop="50px";txtEl.style.fontSize="1.2em";txtEl.innerHTML="📌 Selecione um devedor ou adicione uma nova dívida";this.dashboard.appendChild(txtEl);return;}
    var headerText=this.capitalizeName(this.devedorSelecionado);
    this.dashboard.innerHTML='<div class="header-devedor">'+headerText+'</div>';

    var lista=[],totalPago=0,atrasado=0,salario=this.saldosDevedores[this.devedorSelecionado]||0,totalFatura=0;
    for(var i=0;i<this.dividas.length;i++){if(this.dividas[i].devedor.toLowerCase()===this.devedorSelecionado.toLowerCase()) lista.push(this.dividas[i]);}
    for(var i=0;i<lista.length;i++){
      var d=lista[i],vp=d.totalParcelas>1?d.valor/d.totalParcelas:d.valor;
      totalFatura+=vp*d.totalParcelas;
      if(d.paga) totalPago+=vp;
      if(!d.paga && new Date(d.vencimentoFatura)<new Date()) atrasado+=vp;
    }
    if(!this.abatimentosDevedores[this.devedorSelecionado]) this.abatimentosDevedores[this.devedorSelecionado]=0;

    var miniCard=document.createElement('div');miniCard.className='mini-card show';
    miniCard.innerHTML='<div>Salário: '+salario.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</div><div>Total Pago: '+totalPago.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</div><div>Saldo: '+(salario-totalPago).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</div><div>Atrasado: '+atrasado.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</div><div class="sub-card"><div><strong>Total da Fatura:</strong> '+totalFatura.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</div><div><strong>Abatido:</strong> <span id="abatido-valor">'+this.abatimentosDevedores[this.devedorSelecionado].toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</span></div><div><strong>Restante:</strong> <span id="restante-valor">'+(totalFatura-this.abatimentosDevedores[this.devedorSelecionado]).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</span></div><input type="number" id="input-abater" placeholder="Valor para abater" min="0" step="0.01"><div style="display:flex;gap:8px;"><button id="btn-abater">Abater</button><button id="btn-resetar">Resetar</button></div></div>';
    this.dashboard.appendChild(miniCard);

    for(var i=0;i<lista.length;i++){
      var d=lista[i],vp=d.totalParcelas>1?d.valor/d.totalParcelas:d.valor;
      var diff=Math.ceil((new Date(d.vencimentoFatura)-new Date())/(1000*60*60*24));
      var cor=d.paga?"#19c37d":diff<0?"#ef4146":diff===0?"#f7c948":"#565869";
      var texto=d.paga?"Pago":diff<0?"Atrasada ("+Math.abs(diff)+" dia(s))":diff===0?"Vence Hoje":"Faltam "+diff+" dia(s)";
      var dividaItem=document.createElement("div");dividaItem.className="divida-item show";
      dividaItem.innerHTML='<div class="divida-top"><span>'+d.item+'</span><span class="status" style="background:'+cor+'">'+texto+'</span></div><div>Total: '+d.valor.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+(d.totalParcelas>1?'<span class="valor-parcela">'+vp.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})+'</span>':'')+'</div><div>Parcelas: '+d.parcelaAtual+'/'+d.totalParcelas+'</div><div>Banco: '+(d.banco||'Não informado')+'</div><div>Vencimento: '+d.vencimentoFatura+'</div><div class="divida-actions"><button class="btn-pago">'+(d.paga?'Desmarcar':'Marcar Pago')+'</button><button class="btn-editar">Editar</button><button class="btn-excluir">Excluir</button></div>';
      this.dashboard.appendChild(dividaItem);
    }
  },

  saveAbatimentos:function(){localStorage.setItem("abatimentosDevedores",JSON.stringify(this.abatimentosDevedores));},
  showModal:function(){this.modal.classList.add("show");this.showStep(1);},
  hideModal:function(){this.modal.classList.remove("show");this.editIndex=null;for(var i=0;i<this.fields.length;i++){this.fields[i].value=this.fields[i].type==='number'?1:'';}document.getElementById('input-salario').value=0;},
  saveDivida:function(){
    var obj={};
    for(var i=0;i<this.fields.length;i++){var f=this.fields[i];obj[f.getAttribute('data-key')]=f.type==='number'?parseFloat(f.value||0):f.value.trim();}
    if(!obj.item||!obj.valor||!obj.devedor||!obj.vencimentoFatura){alert('Preencha todos os campos!');return;}
    if(obj.totalParcelas<obj.parcelaAtual||obj.totalParcelas<=0){alert('Parcelas inválidas!');return;}
    obj.devedor=this.capitalizeName(obj.devedor);
    this.saldosDevedores[obj.devedor]=parseFloat(document.getElementById('input-salario').value)||0;
    if(this.editIndex!==null) this.dividas[this.editIndex]=obj; else this.dividas.push(obj);
    this.save();this.hideModal();
  },
  editDivida:function(idx){var d=this.dividas[idx];this.editIndex=idx;for(var i=0;i<this.fields.length;i++){this.fields[i].value=d[this.fields[i].getAttribute('data-key')]!==undefined?d[this.fields[i].getAttribute('data-key')]:"";}document.getElementById('input-salario').value=this.saldosDevedores[d.devedor]||0;this.showModal();},
  save:function(){localStorage.setItem("dividasDaCasa",JSON.stringify(this.dividas));localStorage.setItem("saldosDevedores",JSON.stringify(this.saldosDevedores));this.renderSidebar();this.renderDashboard();},
  exportData:function(){var b=new Blob([JSON.stringify({dividas:this.dividas,saldosDevedores:this.saldosDevedores,abatimentosDevedores:this.abatimentosDevedores},null,2)],{type:'application/json'});var a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='dados_dividas.json';a.click();},
  importData:function(e){var f=e.target.files[0];if(!f)return;var self=this;var reader=new FileReader();reader.onload=function(){try{var data=JSON.parse(reader.result);if(!data.dividas && !data.saldosDevedores){alert('Arquivo inválido!');return;}if(Array.isArray(data.dividas)) self.dividas=data.dividas;if(typeof data.saldosDevedores==='object' && data.saldosDevedores!==null) self.saldosDevedores=data.saldosDevedores;if(typeof data.abatimentosDevedores==='object' && data.abatimentosDevedores!==null) self.abatimentosDevedores=data.abatimentosDevedores;self.save();}catch(err){alert('Erro ao importar!');} e.target.value='';};reader.readAsText(f);}
};

function closeSidebar(){document.querySelector(".sidebar").classList.remove("show");document.getElementById("sidebar-overlay").classList.remove("show");}

App.init();
</script>
</body>
</html>

